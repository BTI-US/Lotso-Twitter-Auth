<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Twitter Actions</title>
</head>
<body>
    <button id="start-auth">Login with Twitter</button>
    <button id="retweet" style="display:none;">Retweet</button>
    <button id="like" style="display:none;">Like</button>
    <button id="bookmark" style="display:none;">Bookmark</button>
    <button id="follow" style="display:none;">Follow</button>

    <script>
        const backendUrl = 'https://oauth.btiplatform.com';
        const tweetId = 'test'; // Replace with the tweet ID you want to perform actions on

        document.getElementById('start-auth').addEventListener('click', function() {
            const callbackUrl = encodeURIComponent('https://lotso.org/twitter-callback');
            const authUrl = `${backendUrl}/start-auth?callback=${callbackUrl}`;
            // Open a new tab with the OAuth URL
            window.open(authUrl, '_blank');
        });

        function getTokensFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            // The accessToken and accessTokenSecret are obtained from the URL query parameters, which is the temporary OAuth token
            // No need to manually obtain from the Twitter developer portal
            const accessToken = urlParams.get('accessToken');
            const accessTokenSecret = urlParams.get('accessTokenSecret');

            if (accessToken && accessTokenSecret) {
                console.log('Access Token:', accessToken);
                console.log('Access Token Secret:', accessTokenSecret);

                // Show action buttons if tokens are available
                document.getElementById('retweet').style.display = 'inline';
                document.getElementById('like').style.display = 'inline';
                document.getElementById('bookmark').style.display = 'inline';
                document.getElementById('follow').style.display = 'inline';

                // Attach event handlers to buttons
                document.getElementById('retweet').addEventListener('click', function() {
                    performAction('retweet', accessToken, accessTokenSecret);
                });
                document.getElementById('like').addEventListener('click', function() {
                    performAction('like', accessToken, accessTokenSecret);
                });
                document.getElementById('bookmark').addEventListener('click', function() {
                    performAction('bookmark', accessToken, accessTokenSecret);
                });
                document.getElementById('follow').addEventListener('click', function() {
                    performAction('follow', accessToken, accessTokenSecret);
                });
            }
        }

        function displayInfo(action, message) {
            if (action === 'retweet') {
                document.getElementById('repostMessage').innerText = message;
            } else if (action === 'like') {
                document.getElementById('likeMessage').innerText = message;
            } else if (action === 'bookmark') {
                document.getElementById('bookmarkMessage').innerText = message;
            } else if (action === 'follow') {
                document.getElementById('followMessage').innerText = message;
            }
        }

        function performAction(action, accessToken, accessTokenSecret) {
            fetch(`${backendUrl}/${action}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    accessToken: accessToken,
                    accessTokenSecret: accessTokenSecret,
                    tweetId: tweetId
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log(`${action} action response:`, data);
                displayInfo(action, data.message);
            })
            .catch(error => {
                console.error('Error performing action:', error);
                displayInfo(action, 'Error performing action');
            });
        }

        window.onload = function() {
            if (window.location.search) {
                getTokensFromURL();
            }
        };
    </script>
</body>
</html>
